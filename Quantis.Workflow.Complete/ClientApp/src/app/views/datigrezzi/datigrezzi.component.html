<div style="margin-top: -25px; padding: 10px"><br />
    <div class="table-responsive" style="background: #ffffff; padding: 5px">
      <br><h2 style="color:#565656">Dati Grezzi</h2><br>
      <div class="row">
        <input type="text" class="form-control ml-3 mr-1" style="width:15%;" placeholder="ID KPI" #searchCol1 [(ngModel)]="viewModel.filters.idKpi" name="idKpi" />
        <input type="text" class="form-control ml-1 mr-1" style="width:15%;" placeholder="Titolo Breve" #searchCol2 [(ngModel)]="viewModel.filters.titoloBreve" name="titoloBreve" />
        <input type="hidden" class="form-control ml-1 mr-1" style="width:15%;" placeholder="Referenti" #searchCol3 [(ngModel)]="viewModel.filters.referenti" name="referenti" />
        <span>&nbsp;&nbsp;</span>
        <select class="form-control" style="width:15%;" #searchCol4 [(ngModel)]="viewModel.filters.tuttiContratti" name="tuttiContratti"><option value="">Tutti i Contratti</option></select>
        <span>&nbsp;&nbsp;</span>
        <select class="form-control" style="width:15%;" #searchCol5 [(ngModel)]="viewModel.filters.tutteLeFrequenze" name="tutteLeFrequenze">
          <option value="">Tutte le Frequenze</option>
          <option value="MENSILE">MENSILE</option>
          <option value="TRIMESTRALE">TRIMESTRALE</option>
          <option value="QUADRIMESTRALE">QUADRIMESTRALE</option>
          <option value="SEMESTRALE">SEMESTRALE</option>
          <option value="ANNUALE">ANNUALE</option>
        </select>
        <span>&nbsp;&nbsp;</span>
        <button class="ml-5" #btnExporta>Esporta CSV</button>
      </div><br />
      <h5 *ngIf="loading" class="text-center text-primary">   
          <span class="fa fa-spinner text-primary fa-spin fa-3x"></span><br /> Caricamento in corso..
      </h5>
      <table class="table stripe kpiTable" #kpiTable id="kpiTable" [ngStyle]="{'display': loading? 'none' : 'unset'}" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" >
        <thead >
          <tr style="color:white;font-size:12px;">
            <th style="text-align:center">CONTRATTO</th>
            <th style="text-align:center">ID</th>
            <th style="text-align:center">TITOLO BREVE</th>
            <th width="50%" style="text-align:center">KPI</th>
            <th class="notExportCsv" style="text-align:center;display:none;">CARICAMENTO</th>
            <th style="text-align:center">FREQUENZA</th>
            <th class="notExportCsv" style="text-align:center;display:none;">ABILITATO</th>
            <th class="notExportCsv" style="text-align:center;display:none;">REMINDER</th>
            <th class="notExportCsv" style="text-align:center;display:none;">WORKFLOW</th>
            <th class="notExportCsv" style="text-align:center;display:none;">REFERENTI</th>
            <th class="notExportCsv" style="text-align:center;display:none;">CALCOLO</th>
            <th class="notExportCsv" style="text-align:center"></th>
            <th style="display:none;" width="0" class="notExportCsv">hide</th>
            <th style="display:none;" width="0" class="notExportCsv">hide</th>
          </tr>
        </thead>
        <tbody>

          <tr *ngFor="let row of kpiTableBodyData; index as i" style="font-size:13px">
            <td [ngClass]="isNumber(row.contract) ? 'rightAlign' : 'leftAlign'">{{row.contract_name}}</td>
            <td [ngClass]="isNumber(row.id_kpi) ? 'rightAlign' : 'leftAlign'">{{row.id_kpi}}</td>
            <td [ngClass]="isNumber(row.id_kpi) ? 'rightAlign' : 'leftAlign'">{{row.short_name}}</td>
            <td class="tagsTip" width="50%" [ngClass]="isNumber(row.kpi_name_bsi) ? 'rightAlign' : 'leftAlign'" data-ext="" attr.data-ext="{{row.kpi_name_bsi}}">{{row.kpi_name_bsi | slice:0:130}} [...]</td>
            <td class="notExportCsv" style="display:none;" [ngClass]="isNumber(row.source_type) ? 'rightAlign' : 'leftAlign'">{{row.source_type}}</td>
            <td [ngClass]="isNumber(row.tracking_period) ? 'rightAlign' : 'leftAlign'">{{row.tracking_period}}</td>
            <td style="display:none;" class="notExportCsv" align="center" *ngIf="row.enable; then trueBlock else falseBlock"></td>
            <td style="display:none;" class="notExportCsv" align="center" *ngIf="row.enable_rm; then trueBlock else falseBlock"></td>
            <td style="display:none;" class="notExportCsv" align="center" *ngIf="row.enable_wf; then trueBlock else falseBlock"></td>
            <ng-template #trueBlock><td style="display:none;" class="notExportCsv" align="center">&#10004;</td> </ng-template>
            <ng-template #falseBlock><td style="display:none;" class="notExportCsv" align="center">&#10006;</td> </ng-template>
            <td style="display:none;" class="notExportCsv" align="center"><button class="btn" data-toggle="modal" data-target="#referentiModal" (click)="populateModalData(row)"><i class="fa fa-user" style="font-size:20px;"></i></button></td>
            <td style="display:none;" class="notExportCsv" align="center"><button class="btn" data-toggle="modal" data-target="#calcoloModal" (click)="coloBtn(row.kpi_computing_description)"><i class="fa fa-edit" style="font-size:20px;"></i></button></td>
            <td class="notExportCsv" align="center">
              <button style="font-size:10px" class="btn btn-primary" data-toggle="modal" (click)="getdati1(row.id_kpi,monthVar,yearVar)"
                      data-target="#daModal" title="DATI">
                      <i class="fa fa-table"></i>
              </button>
            </td>
            <td style="display:none;" width="0" class="notExportCsv">{{row.referent}},{{row.referent_1}},{{row.referent_2}},{{row.referent_3}}</td>
            <td style="display:none;" width="0" >{{row.kpi_name_bsi}}</td>
          </tr>
        </tbody>
      </table>
    </div>
</div>

<div id="referentiModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="classInfo" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<!--        <h5 class="modal-title" id="approveModalLabel">Giustificativo</h5>-->
<button type="button" class="close" data-dismiss="modal" aria-label="Close" >
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<div class="table-responsive" style="background: #ffffff; padding: 10px">
<table id="classTable" class="table stripe">
<thead style="background: #20a8d8">
</thead>
<tbody>
<tr><th width="20%">REFERENTI_INPUT</th><td width="80%"><input type="text" class="form-control" [(ngModel)]="modalData.referent"></td></tr>
<tr><th width="20%">REFERENTI_1</th><td width="80%"><input type="text" class="form-control" [(ngModel)]="modalData.referent_1"></td></tr>
<tr><th width="20%">REFERENTI_2</th><td width="80%"><input type="text" class="form-control" [(ngModel)]="modalData.referent_2"></td></tr>
<tr><th width="20%">REFERENTI_3</th><td width="80%"><input type="text" class="form-control" [(ngModel)]="modalData.referent_3"></td></tr>
</tbody>
</table>
</div>
</div>
<div class="modal-footer">
<button (click)="updateKpi('referents')" class="btn btn-success">Aggiorna</button>
<button type="button" class="btn btn-primary" data-dismiss="modal">Chiudi</button>
</div>
</div>
</div>
</div>

<div id="calcoloModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="classInfo" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="approveModalLabel">Descrizione Calcolo</h5>
<button type="button"   class="close" data-dismiss="modal" aria-label="Close" >
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body" >
<textarea class="form-control" disabled style="background:white">{{this.des}}</textarea>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-primary" data-dismiss="modal">
Chiudi
</button>
</div>
</div>
</div>
</div>

<div id="kpiModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="classInfo"
aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="approveModalLabel">Modifica KPI</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<div class="table-responsive" style="background: #ffffff; padding: 10px">
<table id="classTable" class="table stripe">
<thead style="background: #20a8d8">
</thead>
<tbody>
<tr><th>CONTRAENTI</th><td><span *ngIf="modalData.primary_contract_party_name != 'Unknow'"><b>Primario: </b>{{modalData.primary_contract_party_name}}</span></td><td><span *ngIf="modalData.secondary_contract_party_name != 'Unknow'"><b>Secondario: </b>{{modalData.secondary_contract_party_name}}</span></td></tr>
<tr><th>CONTRATTO</th><td colspan="2">{{modalData.contract_name}}</td></tr>
<tr><th>NOME KPI BSI</th><td colspan="2">{{modalData.kpi_name_bsi}}</td></tr>
<tr><th>DESCRIZIONE</th><td colspan="2"><input type="text" class="form-control" [(ngModel)]="modalData.kpi_description"></td></tr>
<tr><th>CALCOLO</th><td colspan="2"><input type="text" class="form-control" [(ngModel)]="modalData.kpi_computing_description"></td></tr>
<tr><th>ID KPI</th><td colspan="2"><input type="text" class="form-control" [(ngModel)]="modalData.id_kpi"></td></tr>
<tr><th>TITOLO BREVE</th><td colspan="2"><input type="text" class="form-control" [(ngModel)]="modalData.short_name"></td></tr>
<tr>
<th>LOADING FORM</th>
<td colspan="2">
<select class="form-control" [(ngModel)]="modalData.id_form">
<option value="">Loading Form: </option>
<option *ngFor="let item of allForms " value="{{item.form_id}}">{{item.form_name}}</option>
</select>
</td>
</tr>
<tr><th>CARICAMENTO</th><td colspan="2"><input type="text" class="form-control" [(ngModel)]="modalData.source_type"></td></tr>
<tr><th>FREQUENZA</th><td colspan="2"><input type="text" class="form-control" [(ngModel)]="modalData.tracking_period"></td></tr>

</tbody>
</table>
<table id="classTable" class="table stripe">
<thead style="background: #E6E6E6">
</thead>
<tbody>
<tr style="text-align:center"><th >ABILITATO</th><th>REMINDER</th><th>WORKFLOW</th></tr>
<tr><td align="center"><input type="checkbox" [(ngModel)]="modalData.enable" /></td><td align="center"><input type="checkbox" [(ngModel)]="modalData.enable_rm" /></td><td align="center"><input type="checkbox" [(ngModel)]="modalData.enable_wf" /></td></tr>

</tbody>
</table>
</div>
</div>
<div class="modal-footer">
<button (click)="updateKpi('kpi')" class="btn btn-success">Aggiorna</button>
<button type="button" class="btn btn-primary" data-dismiss="modal">Chiudi</button>
</div>
</div>
</div>
</div>


<div id="daModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="classInfo" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="approveModalLabel">DATI</h5><br><br>
       
          
        <button type="button" class="close"  (click)="clear()" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <br>
     <!-- <div class="row" style="margin-left: 20px">
        <p>
            
          <button class="btn btn-primary info-btn" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"><b>INFO</b></button>
          </p>
        </div>-->
        <!--  <div class="row">
           
              <div class="collapse" id="collapseExample">
                <mat-card class="example-card" style="margin-left: 20px;" >
                  <mat-card-header>
                <mat-card-title style="color:#20a8d8;text-align: center;">EVENTI</mat-card-title>
                <mat-card-subtitle style="text-align: center;" *ngFor="let et of eventTypeArray | keyvalue"><b> {{et.key}}:{{et.value}}</b></mat-card-subtitle>
                </mat-card-header>
                 
                  
                </mat-card>
              
            </div>
            
          </div>-->
          <h5 *ngIf='loadingModalDati' id="loader" class="text-center">
            <span class="fa fa-spin fa-spinner fa-3x text-primary"></span>
          </h5>
          
      <div class="modal-body">
          <h4 style="color:#565656;">Periodo:</h4>
          <div class="row">
   
 
            <select [(ngModel)]="monthVar" class="form-control ml-3" style="width:15%;" (change)="getdati1(id_kpi_temp,monthVar,yearVar)"  >
              <option value="">Tutti i mesi</option>
              <option value="01">Gennaio</option>
              <option value="02">Febbraio</option>
              <option value="03">Marzo</option>
              <option value="04">Aprile</option>
              <option value="05">Maggio</option>
              <option value="06">Giugno</option>
              <option value="07">Luglio</option>
              <option value="08">Agosto</option>
              <option value="09">Settembre</option>
              <option value="10">Ottobre</option>
              <option value="11">Novembre</option>
              <option value="12">Dicembre</option>
            </select>
            <select [(ngModel)]="yearVar" class="form-control ml-1" style="width:15%;" (change)="getdati1(id_kpi_temp,monthVar,yearVar)" >
                <option value="">Anno</option>
                <option *ngFor="let year of anni" >{{year}}</option>     
              </select>
        
            </div>
            <br><br>
        <div class="row"><input class="form-control" style="width: 18%;margin-left:22px"  type="text" name="search" [(ngModel)]="filter" placeholder="Cerca">
          <button (click)="fireEvent()"style="margin-left:20%">Esporta CSV</button></div>
          <div class="table-responsive" style="background: #ffffff; padding: 10px">     
            <table id="classTable" class="table table-bordered"  #table>
              <thead style="background: #20a8d8; color:white">  
              <tr>
                 <th style="text-align:center">create date</th>
                 <th style="text-align:center">modify date</th>
                 <th style="text-align:center">raw data id</th>
                 <th style="text-align:center">event type id</th>
                 <th style="text-align:center">resource id</th>
                 <th style="text-align:center">time stamp</th>
                 <th style="text-align:center">reader id</th>
                 <th style="text-align:center">event state id</th>
                 <th style="text-align:center">partner raw_data id</th>          
                 <th *ngFor="let key of countCampiData" style="text-align:center" >campo {{key}}</th>
              </tr>
    </thead>
    <tbody>
        <tr *ngIf="fitroDataById.length==0" >
            <td class="font-italic text-center" colspan="12">
                Nessun dato per il periodo selezionato
            </td>
          </tr>
        <tr *ngFor="let rec of fitroDataById | filter: filter  | paginate: { itemsPerPage: 100, currentPage: p }; index as i">
        
            <td style="text-align:center">{{rec.create_date }}</td>
            <td style="text-align:center">{{rec.modify_date }}</td>
            <td style="text-align:center">{{rec.raw_data_id}}</td>
            <td style="text-align:center">{{rec.event_type_id}}</td>
            <td style="text-align:center">{{rec.resource_id}}</td>
            <td style="text-align:center">{{rec.time_stamp }}</td>
            <td style="text-align:center">{{rec.reader_id}}</td>
            <td style="text-align:center">{{rec.partner_raw_data_id}}</td>          
            <td  style="text-align:center" *ngFor="let key of rec.data | keysPipe"><span *ngIf="rec.data[key] !== '##empty##'"><b>{{key}} :</b> {{rec.data[key] }}</span></td>
          
             <!--  <td colspan="3" style="text-align:center" class="hiddenRow"> <div class="collapse multi-collapse" id="Collapse2"> <br>{{rec.reader_id}} </div> </td>
            <td colspan="3" style="text-align:center" class="hiddenRow"> <div class="collapse multi-collapse" id="Collapse2"> <br>{{rec.partner_raw_data_id}} </div> </td>
            <td colspan="3" style="text-align:center" class="hiddenRow"> <div class="collapse multi-collapse" id="Collapse2"> <br>{{rec.event_source_type_id}} </div> </td>
            <td colspan="3" style="text-align:center" class="hiddenRow"> <div class="collapse multi-collapse" id="Collapse2"> <br>{{rec.event_state_id}} </div> </td>-->
         
          </tr>
    </tbody>
  </table>
  <pagination-controls previousLabel="precedente"  nextLabel="successiva" (pageChange)="p = $event"></pagination-controls>
      </div>
         </div>
         <div class="modal-footer">
           <button type="button" class="btn btn-primary" data-dismiss="modal">Chiudi</button>
         </div>
       </div>
     </div>
   </div>